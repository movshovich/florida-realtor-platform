// Production schema with PostgreSQL
// Use this for deployment: cp schema.production.prisma schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String
  firstName     String
  lastName      String
  phone         String?
  realtorLicense String?
  floridaCounty String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  contacts      Contact[]
  deals         Deal[]
  tasks         Task[]
  interactions  Interaction[]
  documents     Document[]
  purchasedLeads PurchasedLead[]

  @@map("users")
}

model Contact {
  id          String   @id @default(cuid())
  userId      String
  firstName   String
  lastName    String
  email       String?
  phone       String?
  address     String?
  city        String?
  state       String?  @default("FL")
  zipCode     String?
  type        String   @default("LEAD") // LEAD, CLIENT, PAST_CLIENT, REFERRAL_SOURCE
  tags        String[] // Array for PostgreSQL
  notes       String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  deals       Deal[]
  tasks       Task[]
  interactions Interaction[]
  documents   Document[]
  purchasedLeads PurchasedLead[]

  @@map("contacts")
}

model Deal {
  id              String   @id @default(cuid())
  userId          String
  contactId       String?
  propertyAddress String
  propertyCity    String
  propertyState   String   @default("FL")
  propertyZipCode String?
  stage           String   @default("LEAD") // LEAD, FIRST_CONTACT, QUALIFIED, SHOWING, OFFER, UNDER_CONTRACT, CLOSED
  listingPrice    Float?
  offerPrice      Float?
  commission      Float?
  expectedCloseDate DateTime?
  status          String   @default("ACTIVE") // ACTIVE, WON, LOST, ON_HOLD
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  contact         Contact? @relation(fields: [contactId], references: [id], onDelete: SetNull)
  tasks           Task[]
  documents       Document[]

  @@map("deals")
}

model Task {
  id          String   @id @default(cuid())
  userId      String
  contactId   String?
  dealId      String?
  title       String
  description String?  @db.Text
  dueDate     DateTime?
  priority    String   @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  completed   Boolean  @default(false)
  completedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  contact     Contact? @relation(fields: [contactId], references: [id], onDelete: Cascade)
  deal        Deal?    @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@map("tasks")
}

model Interaction {
  id          String   @id @default(cuid())
  userId      String
  contactId   String
  type        String   // EMAIL, CALL, MEETING, TEXT, NOTE
  subject     String?
  notes       String?  @db.Text
  dateTime    DateTime @default(now())
  createdAt   DateTime @default(now())

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  contact     Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@map("interactions")
}

model Document {
  id          String   @id @default(cuid())
  userId      String
  contactId   String?
  dealId      String?
  fileName    String
  filePath    String
  fileType    String
  fileSize    Int
  uploadedAt  DateTime @default(now())

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  contact     Contact? @relation(fields: [contactId], references: [id], onDelete: Cascade)
  deal        Deal?    @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@map("documents")
}

model LeadSource {
  id          String   @id @default(cuid())
  name        String
  type        String
  qualityTier String   // BRONZE, SILVER, GOLD, PLATINUM
  basePrice   Float
  description String?  @db.Text
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  purchasedLeads PurchasedLead[]

  @@map("lead_sources")
}

model PurchasedLead {
  id              String   @id @default(cuid())
  userId          String
  leadSourceId    String
  contactId       String?
  purchasePrice   Float
  qualityTier     String   // BRONZE, SILVER, GOLD, PLATINUM
  status          String   @default("NEW") // NEW, CONTACTED, CONVERTED, EXPIRED
  purchasedAt     DateTime @default(now())
  contactedAt     DateTime?
  convertedAt     DateTime?

  // Relations
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  leadSource      LeadSource @relation(fields: [leadSourceId], references: [id], onDelete: Cascade)
  contact         Contact? @relation(fields: [contactId], references: [id], onDelete: SetNull)

  @@map("purchased_leads")
}

